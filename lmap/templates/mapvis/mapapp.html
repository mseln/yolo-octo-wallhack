<!Doctype html>
<html>
	<head>
		<meta name = "viewport" content = "initial-scale=1.0, user-scalable = no"/>
		<style type = "text/css">
			html {height: 100%}
			body {height: 100%; margin: 0; padding: 0}
			#map_canvas {height: 80%; width: 80% }
		</style>
		<script type = "text/javascript"
			src = "http://maps.google.com/maps/api/js?key={{ GMAPS_API_KEY }}&sensor=false">
		</script>
		<script type="text/javascript">
			var map;
			var state;

			function initialize(){
				var mapOptions = {
					center: new google.maps.LatLng(58.39867, 15.57451),
					zoom: 18,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				// state = 0;
				map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

				google.maps.event.addListener(map, 'click', function(event){
						on_click(event.latLng, "Click: "+event.latLng);
				});

				var inst_element = document.getElementById('inst');	
				var lat1_element = document.getElementById('lat1');
				var lng1_element = document.getElementById('lng1');
				var lat2_element = document.getElementById('lat2');
				var lng2_element = document.getElementById('lng2');

				inst_element.value = "Enter start position";
				lat1_element.value = "";
				lng1_element.value = "";
				lat2_element.value = "";
				lng2_element.value = "";

				
				displayMarkers(map);
				displayRoads(map);
			}

			google.maps.event.addDomListener(window, 'load', initialize);
			function on_click(latLng, title){
				
				var inst_element = document.getElementById('inst');	
				var lat1_element = document.getElementById('lat1');
				var lng1_element = document.getElementById('lng1');
				var lat2_element = document.getElementById('lat2');
				var lng2_element = document.getElementById('lng2');
				if (state != 1){
					lat1_element.value = latLng.lat();	
					lng1_element.value = latLng.lng();	
					state = 1;
					inst_element.value = "Enter target position";
				}
				else{
					lat2_element.value = latLng.lat();	
					lng2_element.value = latLng.lng();	
					state = 0;
					inst_element.value = "Enter start position";
				}
			}

			function createMarker(map, latlng, title){
				var marker = new google.maps.Marker({
					map: map,
					position: latlng,
					title: title
				});
			}

			function displayMarkers(map) {
				{% for coord in COORDS %}
					createMarker(map, new google.maps.LatLng({{coord.lat}},
																									 {{coord.lng}}),
																									 ""+{{coord.id}});
				{% endfor %}
			}

			function createPolyline(map, path){
				var polyline = new google.maps.Polyline({
					path: path,
					map: map
				});
			}

			function displayRoads(map) {
				{% for road in ROADS.values %}
				  var points = new google.maps.MVCArray();
					{% for node in road.values %}
						points.push(new google.maps.LatLng({{node.lat}}, {{node.lng}}));
					{% endfor %}
					createPolyline(map, points);
				{% endfor %}
			}


		</script>
	</head>
	<body>
		<div id="map_canvas"></div>
	</body>
	<form>
		<input type="text" id="inst" name="lat1" size = 16><br>
		Lat 1: <input type="text" id="lat1" name="lat1" size = 8>
		Lng 1: <input type="text" id="lng1" name="lng1" size = 8><br>
		Lat 2: <input type="text" id="lat2" name="lat2" size = 8>	
		Lng 2: <input type="text" id="lng2" name="lng2" size = 8>
	</form> 
</html>

