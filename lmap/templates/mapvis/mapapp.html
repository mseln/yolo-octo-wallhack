<!Doctype html>
<html>
	<head>
		<meta name = "viewport" content = "initial-scale=1.0, user-scalable = no"/>
		<style type = "text/css">
			html {height: 100%}
			body {height: 100%; margin: 0; padding: 0}
			#map_canvas {height: 80%; width: 80% }
		</style>
		<script type = "text/javascript"
			src = "http://maps.google.com/maps/api/js?key={{ GMAPS_API_KEY }}&sensor=false">
		</script>
		<script type="text/javascript">
			var map;

			function initialize(){
				var mapOptions = {
					center: new google.maps.LatLng(58.39867, 15.57451),
					zoom: 18,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

				google.maps.event.addListener(map, 'click', function(event){
						createMarker(map, event.latLng, "Click: "+event.latLng);
				});

				displayMarkers(map);
				displayRoads(map);
			}

			google.maps.event.addDomListener(window, 'load', initialize);

			function createMarker(map, latlng, title){
				var marker = new google.maps.Marker({
					map: map,
					position: latlng,
					title: title
				});
			}

			function displayMarkers(map) {
				{% for coord in COORDS %}
					createMarker(map, new google.maps.LatLng({{coord.lat}},
																									 {{coord.lng}}),
																									 ""+{{coord.id}});
				{% endfor %}
			}

			function createPolyline(map, path){
				var polyline = new google.maps.Polyline({
					path: path,
					map: map
				});
			}

			function displayRoads(map) {
				{% for road in ROADS.values %}
				  var points = new google.maps.MVCArray();
					{% for node in road.values %}
						points.push(new google.maps.LatLng({{node.lat}}, {{node.lng}}));
					{% endfor %}
					createPolyline(map, points);
				{% endfor %}
			}


		</script>
	</head>
	<body>
		<div id="map_canvas"></div>
	</body>
</html>

