<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>TDDD63 Project: Map-based Applications</title>
	<style>
	body {
		counter-reset: h2counter;
	}
	h1 {
		counter-reset: h2counter;
	}
	.countheads ~ h2:before {
		content: counter(h2counter) ".\0000a0\0000a0";
		counter-increment: h2counter;
	}
	h2.nocount:before {
		content: none;
		counter-increment: none;
	}
	h2 {
		counter-reset: h3counter;
	}

	.countheads ~ h3:before {
		content: counter(h2counter) "." counter(h3counter) ".\0000a0\0000a0";
		counter-increment: h3counter;
	}
	h3.nocount:before {
		content: none;
		counter-increment: none;
	}
	h3.projcount:before {
		content: "Extension project " counter(h2counter) "." counter(h3counter) ".\0000a0\0000a0";
		counter-increment: h3counter;
	}
	h3 {
		counter-reset: h4counter;
	}
	.countheads ~ h4:before {
		content: "Exercise " counter(h2counter) "." counter(h3counter) "." counter(h4counter) ".\0000a0\0000a0";
		counter-increment: h4counter;
	}
	h4.nocount:before {
		content: none;
		counter-increment: none;
	}
	h4.projcount:before {
		content: "Extension project " counter(h2counter) "." counter(h3counter) "." counter(h4counter) ".\0000a0\0000a0";
		counter-increment: h4counter;
	}
	h4 {
		counter-reset: h5counter;
	}
	.countheads ~ h5:before {
		content: "Task " counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) ".\0000a0\0000a0";
		counter-increment: h5counter;
	}
	h5.nocount:before {
		content: none;
		counter-increment: none;
	}
	h2.intro{}
	p {text-indent:0px;}
	.noindent,
	p.noindent,
	{
    	text-indent:        0;
	}
	td { min-width: 50px; }
	#wrap { width:500px; margin:0 auto; }
	#main { 
		overflow:auto;
		width: 80%;
    	float: left;
    	padding:10px;
	}
	#sidebar { 
  		margin-bottom: -5000px; 
  		padding-bottom: 5000px; 
  		float:right; 
  		width: 15%;
  	    padding:10px;
  	    height:auto;
  	    border: solid 2px black;
  	}
  	.note { 
  		padding:.8em 1em .8em; 
  		margin: 1em 0; 
  		border:1px 
  		solid #A6A6FB;
  	}
  	.note {
	padding-left:65px;
	background:url("note.png") .8em .8em no-repeat;
	}
	.note-title {
    	color: #487858;
    	font-weight: bold;
    	margin-bottom: 0 !important;
    	margin-top: 0 !important;
	}
  	</style>
</head>

<body bgcolor="#E6E6FA">	
	<div id="sidebar">
		<h2 class="nocount"> Table of contents </h2>
		<ol>
			<li><a href="#intro">Introduction</a></li> 
			<li><a href="#background">Background</a></li>
			<li><a href="#project_intro">Introductory Phase</a></li>
			<ol>
				<li><a href="#django">Creating a Web Application with Django</a></li>
				<li><a href="#gmaps_api">Displaying a Map with the Google Maps API</a></li>
				<li><a href="#explore_osm">Exploring Data from Open Street Map</a></li>
				<li><a href="#disp_osm">Displaying Open Street Map Data</a></li>
			</ol>
			<li><a href="#project_main">Main Phase</a></li>
			<ol>
				<li><a href="#find_path">Assisting a User to Get from A to B</a></li>
				<li><a href="#extend">Extending Your Application Further</a></li>
			</ol>
		</ol>
	</div>
	<div id="main">
	<h1 class="countheads">TDDD63 Project: Map-based Applications</h1>
	<h2><a id="intro">Introduction to map based applications</a> </h2>
	<p>Maps represent the world we live in. They are central in many computer applications. The goal of this project is to create a map-based application including some of the underlying data structures and algorithms. </p>
	<p>As we all know, the numbering of the houses in Ryd can be quite confusing. It has been rumored that there is a research report stating that there is no simple set of rules that describe the numbering. To help you find your way to your friends you need a map application that shows the shortest path between your house and your friends houses.  Since you want to become an expert programmer you decide to write your own application to learn more about the data structures, algorithms, and techniques involved in map applications.</p>
	<p>In the first part of the project a basic web-based map application is developed which you should extended in the second part.</p>



	<h2><a id="background">Background</a></h2>
	<p>Maps have always played a central role in human society. According to <a href="http://en.wikipedia.org/wiki/Map">Wikipedia</a>, a map is "a visual representation of an area -- a symbolic depiction highlighting relationships between elements of that space such as objects, regions, and themes." </p>
	
	<p>The earliest known maps are of the heavens, not the earth. 
	<a href="http://issuu.com/lightmediation/docs/the_lascaux_cave___a_prehistoric_sky-map_3390?mode=embed&documentId=080926150256-7f1d39d0e87c4e28a7515a2712d1e473&layout=grey">Dots dating to 16,500 BCE </a> 
	found on the walls of the 
	<a href = "http://en.wikipedia.org/wiki/Lascaux">Lascaux caves</a>  map out part of the night sky, including the three bright stars Vega,  Deneb, and Altair, as well as the Pleiades star cluster.</p>

	<div>
		<img class="high"  height="60%" width="60%" src="http://image.issuu.com/080926150256-7f1d39d0e87c4e28a7515a2712d1e473/jpg/page_3.jpg" style="display: block;">
	</div>

	<p>Computerized maps have gained popularity especially with the introduction of smart phones with <a href="http://en.wikipedia.org/wiki/GPS_navigation_device">GPS receivers</a>. Equipped with a GPS receiver you know the coordinates of your current location, i.e. you know where you are (roughly, depending on the accuracy of the receiver).  To make those coordinates much more useful, you also need to know where those coordinates are in the world.  In other words, you need a map. With a map displaying your location, according to the GPS, you can do many things such as finding your way to your friend somewhere in Ryd and find the closest pizza place.</p>
	<p>
	There are many popular map-based applications:
	<ul>
	<li> Navigation aids for smart phones and cars.
	<li> Data visualization aids to explore and interact with data such
	as corruption, crimes and natural resources.
	<li> Use crowd sourcing to monitor elections and support disaster
	relief, such as <a href="https://crowdmap.com/">Crowdmap</a> by <a href="http://legacy.ushahidi.com/">Ushahidi</a>.
	<li> Recreational applications such as <a href="http://www.geocaching.com/">Geocaching</a>, <a href="https://foursquare.com/">FourSquares</a>, and
	<a href="http://www.mapmyrun.com/>">MapMyRun</a>.
	<li> For more examples, see <a href="http://googlemapsmania.blogspot.se">googlemapsmania.blogspot.se</a>.
	</ul>
	</p>
	<p> Google Maps is probably the most popular online map as well as map API. As Apple now have their own map application and many users, they might manage to catch up. An interesting fact about Apple's maps is that it is partially developed by the Linköping company C3 Technologies which was acquired by Apple. C3 Technologies is a spin-off company from SAAB that generates accurate 3D maps.
	</p>



	<h2><a id="project_intro">Introductory Phase</a></h2>
	<p>The goal of the introductory phase is to create a web application using the <a href="https://www.djangoproject.com/">Django framework</a>, display a map using the <a href="https://developers.google.com/maps/documentation/javascript/">Google Maps API</a> and to explore map data from the <a href="http://www.openstreetmap.org/">Open Street Map project</a>.</p>
	<p>This part of the project is structured around the following four
	milestones that each consists of a series of exercises. Each exercise
	has a number of tasks that should be completed. </p>
	<ol>
	<li> Create a web application with Django
	<li> Display a map in your web application using the Google Maps API
	<li> Explore Open Street Map data
	<li> Display Open Street Map data on the map in your web application
	</ol>
	<p> When you have reached the last milestone you will have a web application that displays data from Open Street Map on a map using the Google Maps API. </p>

	<h3><a id="django">Creating a Web Application with Django</a></h3>
	<p>The goal of this milestone is to create a basic web application using the Django framework. Django is a Python framework for creating websites. It is very easy to get started with and provides all the functionality needed for this project.</p>

	<h4>Create a Django Project</h4>
	<p>To get started you need to create a Django project. This is done with the help of the <code>django-admin.py</code> program. A Django project is a Python package, i.e. a directory containing the code and the settings for an instance of Django. This includes database configurations, Django-specific options and application-specific settings.</p>

	<h5>Load the <code>tddd63 maps module </code></h5>

	<p>If you are using IDA's Solaris system, then you need to load a module with Django and other software that you need for this project.  The name of the module is <code>tddd63-maps</code>.  To load it into your current terminal use the command <br> <code>module add home/TDDD63/modulefiles/tddd63-maps</code>. </p>

	<p>To automatically load the module every time you create a new terminal execute the command <code>module initadd /home/TDDD63/modulefiles/tddd63-maps</code> once.  This does not load the module into any already created terminals, including the terminal where you executed the command.</p>

	<p> If you are using your own UNIX (Linux, Mac) system then you need to install <a href="https://docs.djangoproject.com/en/dev/topics/install/">Django 1.4.1</a> by yourself. If you are a windows user you have to find out how to set up django yourself. Check how to install it <a href="https://docs.djangoproject.com/en/dev/topics/install/">here</a>.</p>

	<h5>Create the <code>lmap</code> project</h5>
	The following command creates a Django project called <code>lmap</code>:
	<code>django-admin.py startproject lmap</code>

	<h5>Explore project files</h5> 
	Explore the file structure created by Django and read about what the files are <a href="http://docs.djangoproject.com/en/1.4/intro/tutorial01/#creating-a-project">here</a>.

	<h5>Start a web server</h5> 
	<p>To test your application you need to start a web server.  Django comes with a development server which you can use. Change into the outer <code>lmap</code> directory, if you haven't already, and run the command <code>python3 manage.py runserver 0.0.0.0:80XY</code>, where <i>X</i> is your group number (1-6) and <i>Y</i> is a number that each group assigns to each student in their group (0-9). The command starts the development web server and informs you about potential problems and the URL of the server. To get the URL, find the line "Development server is running at <i>URL</i>".<p>

	</p>Check that your web server is working by opening the URL in your browser.</p>


	<h4>Set up an SQLite database</h4>
	<!-- TODO: Link to SQLite -->
	<p>To store information your application needs a database. SQLite is a simple database which is stored in a single file in the file system.</p>

	<h5>Update database configuration</h5> 

	<p>To configure Django to use an SQLite database open the file <code>lmap/settings.py</code>, find the variable <code>DATABASES</code>, assign the variable <code>'ENGINE'</code> the value <code>'django.db.backends.sqlite3'</code>, and change the value of <code>'NAME'</code> to <code>os.path.abspath(os.path.join(os.path.dirname( __file__ ), '..', 'lmap.sqlite3').replace( '\\', '/' )</code>. </p>

	<div class=note>
		<p class=note-title>What does this mysterious expression mean?</p>
		<ul>
			<li><code>os.path.dirname( __file__ )</code> is the directory where the <code>settings.py</code> file is located. </li>  
			<li><code>'..'</code> takes you to the folder above that.</li>
			<li><code>'lmap.sqlite3'</code> is the name of the file that stores the database.</li> 
			<li><code>os.path.join(...)</code> joins the paths togheter.
			<li><code>os.path.abspath(...)</code> returns the absolute path of its argument, which is the relative path created above.</li>
			<li><code>.replace( '\\', '/' )</code> takes the path, which is just a string, and replaces all backslashes (\) with forward slashes (/). This is needed in case you are using Windows, which uses backslashes as separators in paths, while Django (and Unix) uses forward slashes.</li>
		</ul>
	</div>
	<h5>Read about the database configuration</h5>

	<p>Read more about the database options at
	<a href="http://docs.djangoproject.com/en/1.4/intro/tutorial01/#database-setup">docs.djangoproject.com</a>.</p>

	<h5>Create the database and initial tables</h5>
	<p>Your Django project is by default configured to use several database tables. These must be created in the database before they can be used. To do this, execute the command <code>python3 manage.py syncdb</code>.</p>

	<p>When asked about creating a superuser, say "yes". Create a superuser "admin" with your email address and the password "admin".</p>


	<h4>Create a Django app</h4>

	<p>A Django app is a Python package, somewhere in your Python path, that follows a certain convention.  Django comes with a utility that automatically generates the basic directory structure of an app, so you can focus on writing code rather than creating directories.  An app is a reusable Django component that can be used in multiple projects.</p>

	<h5>Projects vs. Apps</h5>

	<p>Read about the differences between a project and an app at
	<a href="https://docs.djangoproject.com/en/1.4/intro/tutorial01/#creating-models">docs.djangoproject.com</a>.</p>

	<h5>Create the mapvis app</h5>

	<p>Change directories to the <code>lmap</code> directory so that you are in the directory with <code>manage.py</code>. To create the <code>mapvis</code> app, execute the command <code>python manage.py startapp mapvis</code>.</p>

	<h5>Explore app files</h5> 

	<p>Explore the file structure created by Django and read about what the files are <a href="https://docs.djangoproject.com/en/1.4/intro/tutorial01/#creating-models">here</a>.</p>


	<h4>Make your app generate a web page</h4>
	<p>The next step towards a web application is to generate your first web page.  In Django, and in other frameworks based on the <a href="http://en.wikipedia.org/wiki/Model-view-controller">Model View Controller</a> design pattern, this is done through a <i>view</i>. To make a page available to a user it has to be associated with a URL. From a Django programming perspective, the content of a page is produced by a view function and a URL is specified in a URLconf.</p>

	<p>Read about views and associating URLs to views <a href="http://www.djangobook.com/en/2.0/chapter03.html">here</a>.</p>


	<h5>Create a view displaying a message</h5>
	<p>In the <code>mapvis</code> app directory, there is a file <code>views.py</code>. This is were you should place your view functions.  Enter the code below to create a view function that generates a page with the classical message "Hello world".</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/hello_world.py"></script>

	<p>Read about what this code does
	<a href="http://www.djangobook.com/en/2.0/chapter03.html">here</a>.</p>

	<div class=note>
		<p class=note-title>Debugging tips:</p>
		<ol>
		<p.noindent>If something goes wrong you need to find out what the problem is. Often you do that by checking the values the relevant variables. This can be done in several ways.  Some of the alternatives are listed below.</p> 

		<li>Using <code>print</code> is a very easy way to debug in Python. It simply prints a given value to the console. If you are running a web server it will print the output in the same terminal as the server is running in.</li>
	
		<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/debug_print.py"></script>

		<li>As you may already have seen, the Django error view contains a lot of information. It contains all the variables and their values. You can get this information by adding <code>assert(False)</code> anywhere in your code. This will cause the program to "crash" and show all the information about the current view. Try it out in your hello world view! Add <code>assert(false)</code> just before <code>return HttpResponse("Hello world")</code> and reload the page</li><br>

		<li>Python also has a built-in debugger called <code>pdb</code>. A debugger makes it possible to step trough the code one step at a time and see what goes on at each step. Read <a href="http://stackoverflow.com/questions/4228637/getting-started-with-the-python-debugger-pdb">getting started with pdb</a> to learn more about pdb.</li>
		</ol>

	</div>

	<h5>Connect a URL to your view</h5>

	<p>Let us continue by associating a URL with the view function so that you can view the result in your web browser.  To do this you have to edit the file <code>lmap/urls.py</code>.  When you created the <code>lmap</code> project a default files was created.  The important part of that file is the variable <code>urlpatterns</code>.  If you inspect the file, you will see several examples of how to associate URLs with views.</p>

	<p>To associate the view you created in the previous task with the relative URL "hello" you need to do two things:
	<ol>
	<li> Import the view function by adding 
	  <code>from mapvis.views import hello</code> 
	  after the existing import statement.
	<li> Create a URL pattern by adding the line 
	  <code>('^hello/$', hello),</code> after<br> 
	  <code>urlpatterns = patterns('',</code>.
	</ol>

	The file will now look something like this:</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/hello_world_url.py"></script>
	<p>
	Now you can start the development web server and open the page <i>URL</i>/hello in your web browser. Congratulations, you have now generated a web page using Python!
	</p>

	<p>If you haven't already, read about what this code does
	<a href="http://www.djangobook.com/en/2.0/chapter03.html">here</a>.</p>

	<h5>Create a view that generates a page showing the current time</h5>
	<p>It is important to emphasize that the view function you just created is a plain Python function which generates a string, which is interpreted as a <a href="http://en.wikipedia.org/wiki/HTML">HTML</a> page by your browser.</p>

	<p>The hello view you created returns a static string. Let us make it a bit more interesting by including the current date and time. This means that every time your reload the page a new string is generated (unless you reload it faster than the resolution of the clock, but then you have to be pretty darn fast).</p>

	<p>To achieve this you need to import <code>datetime</code>, get the current date and time with the function <code>datetime.datetime.now()</code> and then generate an HTML page in the form of a string.  Why not try doing this on your own? </p>

	<p>When you are done your code should look something like this:</p>
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/hello_world_time.py"></script>

	<p><i>Note: If you are wondering why the application are showing the wrong time, it is probaly because you haven't set up the right timezone. How to fix that you have to find out yourself, it is a good excercise</i></p>

	<p>If you still have a hard time understanding what the code snippets above do. Take some time and read through the whole <a href="http://www.djangobook.com/en/2.0/chapter03.html">Views and URLconfs</a> from django book.</p>

	<h5>Play around with your view</h5>

	<p>If you know some HTML this would be a good time to play around with the view function and elaborate the page generated.  For example, make the current time bold.  You can also use your Python skills to for example display only the current time or format the date a bit nicer.</p>

	<p>A good HTML tutorial is available <a href="http://www.w3schools.com/html">here</a>.</p>


	<h4>Generate a web page using a template</h4>
	<!-- TODO: Explain what a template is and how it works. -->
        <!-- TODO: Give examples of variables, if and for loops in templates. -->
	<p>In the previous exercise you created a web page by hard coding the content. A much better approach is to use the Django template facility. It allows you to combine hard coded and generated HTML/<a href="http://en.wikipedia.org/wiki/Cascading_Style_Sheets">CSS</a>/<a href="http://en.wikipedia.org/wiki/Javascript">JavaScript</a> in more user friendly manner than creating a very long string by concatenating smaller strings.</p>

	<p>You can read more about Django's templates <a href="http://www.djangobook.com/en/2.0/chapter04.html">here</a>.</p>

	<h5>Create a directory for your templates</h5>

	<p>You need somewhere to store your templates. The convention is to create a directory called <code>templates</code> in the project directory and in it a sub directory for each application with the same name as the application.</p>

	<p>Create a directory <code>templates</code> in the project directory and a directory <code>mapvis</code> in that directory.</p>

	<h5>Update the project configuration to find your templates</h5>

	<p>Now that you have a directory for templates you need to configure your project to find those templates.  This is done by editing the file <code>lmap/settings.py</code>.</p>

	<p>Find the variable <code>TEMPLATE_DIRS</code> in the file <code>lmap/settings.py</code> and add the absolute path to newly created <code>templates</code> directory. If you have followed the instructions, you should add <code>os.path.abspath(os.path.join(os.path.dirname( __file__ ), '..', 'templates')).replace( '\\', '/' ),</code> to the list <code>TEMPLATE_DIRS</code>.</p>

	<h5>Create a view rendering a page from the template</h5>

	<p>A template is basically a text file where some parts are interpreted as variables and macros which are expanded to generate several different instances of the text. To generate an instance of a template it is instantiated with a <i>context</i> which is basically a Python dictionary. </p>

	<p>Create a view called <code>mapapp</code> in the file <code>views.py</code> with the following code. The code creates a context associating the key <code>NOW</code> with the current date and time, instantiates the template <code>map/mapapp.html</code> and returns it as a response to an HTTP request.</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/mapapp.py"></script>

	<p>You also need to associate a URL with the view, this is done by adding <code>('^mapapp/$', mapapp),</code> to <code>urlpatterns</code> in the file <code>lmap/urls.py</code>.</p>

	<h5>Create a page template</h5>

	<p>The template itself is a text file <code>mapapp.html</code> in the directory <code>templates/mapvis</code>.</p>

	<p>To create a page with the same content as the hello view use the following template:</p>


	<h5>What happens if you open the site root?</h5>

	<p>Open the site root. What happens? Why?</p>

	<h5>Associate the mapapp view with the site root</h5>

	<p>Now you should know enough to be able to create a URL pattern that associates the <code>mapapp</code> view with the site root.  If you need advice, read <a href="http://www.djangobook.com/en/2.0/chapter03.html">djangobook chapter03</a>.</p>

	<h5>Play around with views and templates</h5>

	<p>To learn more about views and templates we suggest that you play around with them for a while. Try to create something impressive and show it to the other groups.</p>



	<h3><a id="gmaps_api">Displaying a Map with the Google Maps API</a></h3>
	The goal of this milestone is to extend the web application created to
	display a map using the Google Maps API. Since this API is written for
	JavaScript this milestone involves some very simple JavaScript
	programming. Most of the code needed will be provided for you. As
	this project shows, most applications require several different
	languages since each language has its own purpose and application
	domain.

	<h4>Learn more about Google Maps</h4>

	Take a few minutes to read about Google Maps at
	<a href="http://developers.google.com/maps/">developers.google.com</a>.

	<h4>Learn more about the Google Maps JavaScript API</h4>

	Take a few minutes to read about the Google Maps JavaScript API
	version 3 at
	<a href="http://developers.google.com/maps/documentation/javascript/">developers.google.com</a>.

	<h4>Get your own Google Maps API Key</h4>

	To access the Google Maps API you need a key. Obtain your own key by
	following
	<a href="http://developers.google.com/maps/documentation/javascript/tutorial#api_key"> these</a> instructions.

	<h4>Display a map</h4>

	Now that you know what the Google Maps API is and have your own API
	key, you are ready to display your first map.

	<h5>Import Google Maps JavaScript code</h5>

	To display a map, replace the content of the file
	<code>templates/mapvis/mapapp.html</code> with the following HTML, CSS and JavaScript code.

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/template.html"></script>

	<p>To understand what the code above does, take a look at the <a href="https://developers.google.com/maps/documentation/javascript/tutorial">Google Maps JavaScript API tutorial</a>.</p>

	<div class=note>
		<p class=note-title>Debugging tips:</p>
		<p>To debug javascript you need to use some sort of tool, otherwise you would only get a white page if something goes wrong and that doesn't say too much does it?<br>

		One of those tools is <a href="https://getfirebug.com/">firebug</a> which is an both free and open source plugin for browsers. With firebug you can see the source of the page you're visiting. It can also enable javascript's console to get error messages, which makes it a lot easier to find the missing "}" for instance. Firebug will also notify you about errors and warnings when you're browsing any site, if enabled.</p>

		<p>Another way to debug javascript is to use alert which generates a pop-up window containing text. </p> 
		<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/debug_javascript.js"></script>
		You can paste the code sample above anywhere you want in javascript code and it will make a pop-up window appear when that statement is reached.
	</div>

	<h5>Create a view that generates the map page</h5>

	<p>To display the map, you also need to update the <code>mapapp</code> view function by including your Google Maps API key in the Context so that it is included in the generated web page. The complete code for the view function is:</p> 

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/mapapp_gmap.py"></script>

	<p>The <code>Context</code> object works like a dictionary but with some extensions.<br>
	Read about <a href="https://docs.djangoproject.com/en/dev/ref/templates/api/#django.template.Context"><code>Context</code></a> and <a href="https://docs.djangoproject.com/en/dev/ref/templates/api/">Templates</a> in the documentation.</p>

	<h5>Change the map center</h5>

	<p>Currently the map is centered on Sydney, Australia. This can be changed. The latitude and longitude of Linköping University is 58.3985303, 15.5745319. To change the center of the map, update the value of the mapOptions property center to <code>center: new google.maps.LatLng(58.3985303, 15.5745319),</code>.</p>

	<h5>Change the zoom level</h5>

	<p>When you reload the page you see that the map is centered on Linköping. To zoom in on the university change the zoom level in the template code from 8 to 16.</p>

	<h5>Change the map type</h5>

	<p>There are several types of maps that can be displayed.  The following map types are available in the Google Maps API:
	<ol>
	<li> <code>MapTypeId.ROADMAP</code> displays the default road map view,
	<li> <code>MapTypeId.SATELLITE</code> displays Google Earth satellite images,
	<li> <code>MapTypeId.HYBRID</code> displays a mixture of normal and satellite views, and
	<li> <code>MapTypeId.TERRAIN</code> displays a physical map based on terrain information.
	</ol></p>

	<p>Try the different types out! In the end we suggest you use either <code>ROADMAP</code> or <code>HYBRID</code>.</p>

	<h4>Place a marker with a click on the map</h4>

	<p>You now have a web application displaying a map. To make it more interesting you will now allow a user to add markers to the map by clicking on it and displaying the latitude and longitude of that location when the mouse is over the marker.</p>

	<h5>Create a JavaScript function for displaying a marker</h5>

	<p>To display a marker you need to create a new object of the type <code>google.maps.Marker</code> with a reference to the map, the latitude and longitude of the marker, and the title of the marker. The title is a string that is displayed when the mouse is placed on the marker.</p>

	<p>Copy the following helper function into your template after the line<br> <code>google.maps.event.addDomListener(window, 'load', initialize);</code>:</p>
	
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/create_marker.js"></script>

	<h5>Create a marker on the click of the mouse</h5>

	<p>To create a marker when the user clicks the mouse on the map you need to associate a function with the event handler for the event <code>click</code>.  When a user clicks on the map, a <code>click</code> event is generated which contains the latitude and longitude of the position of the click in the event attribute <code>latLng</code>.</p>

	<p>The event handler is the createMarker function you created above.</p>

	<p>To create the event handler, copy the following code to the end of the initialize() function you created before:</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/click.js"></script>

	<p>Test the functionality by reloading the web page and finding the coordinates of for example Zenit, your current location, and your house.</p>

	<p>You now have a basic map application. Pretty nice, right?</p>



	<h3><a id="explore_osm">Exploring Data from Open Street Map</a></h3>

	<p><a href="http://www.openstreetmap.org/">Open Street Map</a> (OSM) is an open source alternative to Google Maps which is created by volunteers, where many people, including members of Lysator, have contributed. Open Street Map contains data about for example nodes, roads and buildings.  A node is a point which is of interest, usually as part of a road or a building.</p>

	<p>The goal for this milestone is to download and explore the data in the Open Street Map project for a suitable area of Linköping.</p>

	<h4>The Linköping part of the Open Street Map project</h4>

	<p>Familiarize yourself with the Linköping part of the Open Street Map project</p>

	<h5>Linköping working group</h5>

	<p>The url <a href="http://wiki.openstreetmap.org/wiki/WikiProject_Sweden/Linköping">http://wiki.openstreetmap.org/wiki/WikiProject_Sweden/Linköping</a> is the homepage of the Linköping part of the OSM project. Follow the link and investigate how this group structures their work.</p>

	<h5>A map of Linköping</h5>
	<p>The following url <a href="http://www.openstreetmap.org/index.html?lat=58.40&lon=15.61&zoom=12">http://www.openstreetmap.org/index.html?lat=58.40&lon=15.61&zoom=12</a> leads to a visual representation of the OSM data for the Linköping area, i.e. a map! Spend enough time exploring the map to be able to form an informed decision regarding whether the OSM data seems to be of high quality or not. In particular, it might be good to compare this map to the corresponding map area in Google Maps (hint: change the center of the map and the zoom level in your web application to the same values as above and reload your application).</p>


	<h4>Gathering map data</h4>

	<p>Download a suitable portion of the OSM data for Linköping.</p>

	<h5>Fetch OSM data from the web</h5>

	<p>Use your web browser to go to <a href="http://www.openstreetmap.org/index.html?lat=58.40&lon=15.61&zoom=12">http://www.openstreetmap.org/index.html?lat=58.40&lon=15.61&zoom=12</a> and click on "Export" in the menu on top of the page.</p>

	<h5>Choose an area</h5> 

	<p>Choose minlat="58.3773000", minlon="15.5207000", maxlat="58.4236000",<br> maxlon="15.6248000", and "OpenStreetMap XML-data".</p>

	<h5>Export the data</h5>

	<p>Press "Export". You will now receive a file containing roughly 11 MB of map data around which you will build your map application. Be sure to always keep an untouched version of this file backed-up somewhere and always work on a copy of this file.</p>

	<h4>A first look at the OSM data</h4>

	<p>In this exercise you will take a first look at the OSM data.</p>

	<h5>Actually look at the data</h5>

	<p>Open the OSM data file you have just downloaded in a text-editor of your choice.</p>

	<h5>XML</h5>

	<p>The data is in XML format. XML is a way to present structured data so that is is readable both by humans and machines. Read the <a href="http://en.wikipedia.org/wiki/XML">Wikipedia page about XML </a> to learn the basics about how this format works.</p>
	 
	<h5>OSM XML</h5>

	<p>OSM has its own particular set of XML tags and rules for how to use them. The web page <a href="http://wiki.openstreetmap.org/wiki/OSM_XML">http://wiki.openstreetmap.org/wiki/OSM_XML</a> contains specifications of the basic tags as well as links to their intended usage. Study this page. In particular, it is important that you learn how the data primitives <code>nodes</code>, <code>ways</code>, and <code>relations</code> are used to build the geographical information contained in a map.</p>  

	<h5>Which information does a <code>node</code> contain?</h5>

	<p>Find out what information a <code>node</code> contains.</p>

	<h5>Which information does a <code>way</code> contain? </h5>

	<p>Find out what information a <code>way</code> contains.</p>

	<h5>Which information does a <code>relation</code> contain? </h5>

	<p>Find out what information a <code>relation</code> contains.</p>

	<h5>How do you represent a road using OSM XML data?</h5>

	<p>Find out how to represent a road using OSM XML data.</p>

	<h5>How do you represent a building using OSM XML data?</h5>

	<p>Find out how to represent a building using OSM XML data.</p>


	<h4>Using web tools to investigate OSM data</h4>

	<p>In this exercise you will use the web tool osmhack to investigate OSM data.</p>

	<p>
	</font>The web page <a href="http://toolserver.org/~kolossos/osm/osmhack.php?lat=58.40&lon=15.61&name=Linköping">http://toolserver.org/~kolossos/osm/osmhack.php?lat=58.40&lon=15.61&name=Linköping</a> automatically generates a list of the OSM map features used in the Linköping map. Clicking a link in the "Values" column generates a map with all map elements carrying the corresponding map feature highlighted in red.
	</p>

	<h5>Motorways</h5>

	<p>Click "Motorway". Which major road is highlighted in red?</p>

	<h5>Roads and streets</h5>

	<p>Investigate your map data by checking which map features of roads and streets might be interesting for your application to utilize.</p>

	<h5>Campus Valla</h5>

	<p>In particular, which features do the roads, cycleways and foot paths on Campus Valla put to use?</p>


	<h4>Using Python tools to parse and investigate OSM data</h4>
	<!-- TODO: Explain what a SAX parser is, what the OSM parser does and how they are connected. -->
	<p>We now want you to start processing the OSM data by executing programs you have written yourself. Parsing the rather extensive OML XML format is not an easy task. You will therefore use a ready made parser for at least the introductory phase.</p>

	<p>Hint: You might have to change the directory and file name of the OSM map file to make the code work.</p>

	<h5>How many nodes does your Linköping map data have?</h5>

	<p>Find out how many nodes your Linköping map data contains by writing a program that counts them and how much time it takes.</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/parser_ex.py"></script>

	<h5>Learn more about the parser</h5>

	<p>Write Python programs to answer the following questions. To answer these questions you have to look inside the <code>osm_parser.py</code> file
	<ol>
	<li> How many <code>edges</code> are there in your OSM data	</ol></p>
	<h5>Your own investigations</h5>

	<p>Try to come up with at least 3 questions of your own about the map data and answer them by using the osm_parser.</p>

	<h3><a id="disp_osm">Displaying Open Street Map Data</a></h3>

	<p>Now you will put together all the pieces you have learned so far by extending the web application to display locations from Open Street Map on the map.</p>

	<p>The goal of this milestone is to create a simple data structure for storing locations (nodes), populate the data structure with data from the Open Street Map project, and display all the nodes on the map.</p>

	<h4>Create a data structure to store locations</h4>

	<p>At the moment, all we want to be able to do is to keep all nodes with their longitude and latitude in memory. To do this, we represent nodes with a simple Python class holding the node id and its associated longitude and latitude:</p>
	
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/node.py"></script>

	<p> Create a file called <code>store.py</code> and insert the code above there.</p>

	<p>The data structure to store all the nodes will now simply be a dictionary using the node id as key and an array <code>bounds</code> to keep track of the boundaries of the nodes.<p>
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/store_nodes.py"></script>

	<p> Using the <code>osm_parser</code> to
	parse our map data we get the following Python code:</p>
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/extract_osm_nodes.py"></script>



	<h5>Use the <code>extract_osm_nodes</code> function</h5>

	<p>Write Python code that uses the <code>extract_osm_nodes</code> function to read your OSM data, store it in the <code>NodeSet</code> class and then print out all nodes that are stored in memory.</p>

	<h4>Only use nodes in a particular rectangular area</h4>

	<p>In the map application we will need to draw all nodes in the rectangular area currently visible in the map window. This operation may have to be done multiple times, which is why we need a class holding only the nodes inside this particular rectangle. The following Python snippet creates an object holding only the nodes fitting that description:</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/select_nodes_in_rectangle.py"></script>




	<h5>Use the <code>select_nodes_from_rectangle</code> function</h5>

	<p>Write Python code to get hold of, and print out, only the nodes within the rectangular area given by</p>


	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/area.py"></script>


	
	<h4>Write unit tests for the <code>select_nodes_from_rectangle</code> function</h4>

	<p>When you develop software it is essential to <i>test</i> that it does what it is supposed to do.  Especially when you develop data structures and algorithms creating good test cases is both easy and could save a lot of time. To test a single unit of a program, such as a function or a class, is called <i>unit testing</i>. In this exercise you will implement unit tests for the <code>select_nodes_from_rectangle</code> function.</p>

	<h5>Learn more about unit testing</h5>

	<p>Read the Wikipedia article on <a href="http://en.wikipedia.org/wiki/Unit_testing">unit testing</a>.</p>

	<h5>Create a simple unit test Using Python's <code>unittest</code> package</h5>

	<p>One of many advantages of Python is that it has a built in unit testing framework which is called <code>unittest</code>. Read more about it <a href="http://docs.python.org/library/unittest.html">here</a>.</p>

	<p>Here is an initial unit test for the <code>select_nodes_in_rectangle</code> function.</p>
	
	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/test_select_nodes_in_rectangle.py"></script>

	
	<p>The code assumes that <code>select_nodes_from_rectangle</code> is in the file <code>store.py</code>, change this if necessary.</p>

	<p>Run the unit test by executing the Python script (<code>python3 test_select_nodes_from_rectangle.py</code>). Make sure that your existing codes passes the three test cases.</p>

	<h5>Implement the <code>test_all_nodes_inside</code> test case</h5>

	<p>In the code above the test case <code>test_all_nodes_inside</code> is not implemented. To implement it, add the following code:</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/test_all_nodes_inside.py"></script>

	
	<p>Run the updated unit test and you should get a similar error message as shown below. Why does it fail? What is wrong, the implementation of <code>select_nodes_in_rectangle</code> or the test case? Fix the problem and run the unit tests to make sure your code works.</p>

	<img src="test_failed.png" alt="test_error">

	<h5>Implement the <code>test_some_nodes_inside</code> test case</h5>

	<p>Using what you have learned so far, implement the test case <code>test_some_nodes_inside</code> and make sure all unit tests are passed by your code.</p>

	<h5>Add unit tests for the <code>Node</code> class</h5>

	<p>Now that you know how to create unit tests create one for the <code>Node</code> class. There should be for example be tests to make sure that the latitudes and longitudes are always within their bounds. Create both hand made test cases as well as randomly generated test cases. You can read more about latitudes and longitudes <a href="http://en.wikipedia.org/wiki/Geographic_coordinate_system">here</a>.</p>

	<a href="http://www.diveintopython.net/unit_testing/">Dive into python</a> has a great introduction to unittesting. It's really worth reading.
	<div class=note>
		<p class=note-title>Run all test files with one command</p>
		<p>To run all unit test files, cd to the folder containing all unittests and execute the command <code>python3 -m unittest discover</code>. The command automatically discovers all files starting with "test" and searches them for test classes.</p>
	</div>
	<h4>Extend the map application to display all locations</h4>

	<p>To display nodes from OSM as markers on the map you need to select an area, extract those nodes you would like to display, and call createMarker for each of those.</p>

	<p>This is done in two steps, extend the view and then extend the template.</p>

	<h5>Extend the view to include a set of markers</h5>

	<p>The following code parses the file <code>linkoping_map.osm</code> in the same directory as the view code, extracts all nodes in a rectangle corresponding to the area between the E-house and the physics building, and adds the list of nodes to the context used to render the map.</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/mappapp.py"></script>


	<h5>Extend the template to display a set of markers</h5>

	<p>In the previous task you created a list of node objects and associated them with the identifier <code>COORDS</code> in the context. To display each of these nodes as a marker you can use the excellent Django template functionality. Basically, you can use simplified Python code to loop over a list and extract the attributes of each object. The following Django template code generates a JavaScript function to display all the nodes associated with <code>COORDS</code> as markers. Include the code last in the JavaScript section of the <code>mapapp.html</code> template.</p>

	<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/display_markers.js"></script>


	<p>To display the markers you also need to call the function (<code>displayMarkers(map);</code>) in the initialize() function, preferably at the end.</p>


	<h2><a id="project_main">Main Phase: Assisting a User to Get from A to B</a></h2>

	<p>Congratulations, you have now learned how to create a web application displaying a map, how to extract data from the Open Street map project, store it in a data structure and display it in your web application.  Equipped with this, you will now create more advanced map-based web applications.

	The first step is to extend your web application to assist a user to find her way between two locations.  This is the basis for direction and route finding applications such as those provided by Google and Apple.</p>

	<p>The image below is showing how the finished product could look like, of course yours are going to be prettier.</p>
	
	<div align="center">
		<img border="0" src="mapapp_overview.png" alt="Web interface" width="1023" height="567">
	</div>

	<p>The goal of this part of the project is to develop a web application that assists a user to get from a location A to a location B. To achieve this, the application should allow a user to select two locations on a map, compute the shortest path between these locations and display the path on the map.  To compute the shortest path you also need to create a data structure storing information about which locations are connected and the distances between them as well as populate it with real map data.  At the end of this part of the project you will have an application similar to the one in</p>

	<h3><a id="">Extend the map application to store and display roads</a></h3>
	<p>Milestones:
	<h4>Store an edge</h4>
	    Create a data structure to store roads and appropriate unit tests. Make sure that your code passes all the unit tests. A suggestion is to create a data type called <code>Edge</code> that stores a single edge. An edge is a directed connection between two nodes so a road would contain a lot of edges.
	      
	      <script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/edge.py"></script>

	<h4>Get the data from the osm file</h4>
	    Populate the data structure with roads from Open Street Map. The following snippet contains a suggested way to structure the code. You will have to fill in the missing pieces of code.
	      
	      <script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/extract_osm_edges.py"></script>

	<h4>Store all the edges    <img src="all_the_roads.jpg" style="width: 7%; height: 7%"></h4>
	    To store all roads, we suggest that you create a new class EdgeSet witch contains all edges. Between all connected we have to create an edge which is going to be stored in a list of edges.

	    By having this structure it becomes straight forward to create a Django template for iterating through all roads and for each road create a polyline by iterating through all coordinates and adding each coordinate to the polyline. To help you, we provide the following example JavaScript code:

	      <script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/polyline.js"></script>

		<h3><a id="">TODO: Create a new title for each major milestone</a></h3>
		<!-- TODO: For each major milestone, create a new section with a title, write a short introduction, then have a list of minor milestones. -->
		<h4>Shortest path</h4>
		Implement a shortest path algorithm together with appropriate unit tests. Now might be a good time to try a test-driven development methodology <a href="http://en.wikipedia.org/wiki/Test-driven_development">test-driven development methodology</a>, where you start by defining the test cases and then develop the code until it passes all the test cases. It is of course possible to start with a few initial test cases which are then extended together with the code they test.

		<h5>Create a mathematical graph</h5>
		Create a data structure to store connections between locations and the lengths of these connections. The usual way to model interconnected locations that are a certain distance apart is by using a (combinatorial) graph. Read up on:
		<ul>
			<li> 
				the mathematical concept of a <a href="http://en.wikipedia.org/wiki/Graph_(mathematics)">graph</a>
			</li>
			<li> 
				typical <a href="http://en.wikipedia.org/wiki/Graph_(data_structure)">data structures</a> used to represent graphs.
			</li>
		</ul>
		You now have to make a preliminary decision concerning how you want to store the distance graph. We suggest that you make your choice between using
		<ul>
			<li> 
				<a href="http://en.wikipedia.org/wiki/Adjacency_list">adjacency lists</a>, or
			</li>
			<li> 
			  	an <a href="http://en.wikipedia.org/wiki/Adjacency_matrix">adjacency matrix</a>.
			</li>
		</ul>

		<h5>Implement it in python</h5>
		<p>Implement your chosen data structure in Python and make sure you have appropriate test cases.</p>

		<p>Then populate the data structure with data from Open Street Map. To do this you will have to decide how to calculate the geographical distance between two nodes that are part of a road. Since Earth is not flat, the distance between two points on the map cannot simply be calculated as the two dimensional Euclidean distance. One way is to use the haversine formula, as in the following Python code snippet:

		<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/haversine.py"></script></p>

	<h5>Implement the shortest path algorithm</h5>
	<p>Implement a provable optimal algorithm to compute the shortest path between two locations using the graph data structure together with appropriate test cases (you do not have to prove that it is optimal). You should write your own code implementing and testing an existing algorithm, There are many algorithms for finding the shortest path between two nodes in an edge weighted graph. For this project we suggest you start out by implementing(<a href="http://en.wikipedia.org/wiki/Dijkstra's_algorithm">Dijkstra's algorithm</a>).</p>

		<div class=note>
			<p class=note-title>Note on running time:</p>

			<p>Dijkstras algorithm for an adjacency matrix is not the most optimal, for graphs that has more than 1000 nodes it becomes time consuming. Below is a table of how the number of nodes is proportional to the running time. The <a href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm#Running_time">time complexity</a> for dijkstra is O(V^2) but can be improved.</p>

			<table border="1">
				<tr>	<th>Nodes</th>	<th>Time (s)</th>	</tr>
				<tr>	<td>542</td>	<td>0.18</td>		</tr>
				<tr>	<td>740</td>	<td>0.47</td>		</tr>
				<tr>	<td>1284</td>	<td>2.74</td>		</tr>
				<tr>	<td>1744</td>	<td>6.08</td>		</tr>
				<tr>	<td>2694</td>	<td>25.5</td>		</tr>
				<tr>	<td>3652</td>	<td>66.4</td>		</tr>
			</table>

			<p>As you can see the algorithm start to take a serious amount of time at around 1000 nodes. There are improvements to make e.g. using a heap instead of a matrix or create an abstract graph of only the crossings. But we leave them out for now and focus on getting a working shortest path application for a small area. In section 4.2. you can choose the extension project which includes speeding up the algoritm.</p>
		</div>
	</p>
	<h4>Find and display the shortest distance</h4> 
	Extend the map application to find and display the shortest <b>distance</b> between two locations.
	<h5>Fitting title</h5>
	Extend the application to allow entering the coordinates of the start and destination by clicking on the map. To achieve this you have to do at least the following:
	<ol>
		<li> 
			Create an HTML form with at least four fields, start latitude, start longitude, destination latitude and destination longitude. Read about HTML forms <a href="http://www.w3schools.com/html/html_forms.asp">here</a>.
		</li>
		<li> 
			Create an on click event handler that fills in the fields in the form when a user clicks on the map. Since the user needs to select two coordinates you have to find a way to do that (one approach is to have a very simple state machine with two states, one for entering the start coordinate and one for entering the destination coordinate). In the introductory part you created an on click event handler so the new thing is to populate a form with that data. One page discussing this is <a href="http://www.javascript-coder.com/javascript-form/getelementbyid-form.phtml">
			javascript-coder.com</a>.
		</li>
		<li>
			<p.noindent>Process the content of the form in the view. To when you press the "Go" button, you are directed to the same page. The content of the form is sent by <a href="http://en.wikipedia.org/wiki/POST_%28HTTP%29">POST</a> and is avaible from django's <a href="https://docs.djangoproject.com/en/dev/ref/request-response/#django.http.HttpRequest.POST">request.POST</a>.</p>

			<p.noindent>Below is some code for an object that handles POST requests. <i>Note: all the values are defined in the initialization, when the object is first defined i.e. nothing happens with the values in the object until the "Go" button is pressed</i></p>
			<script src="http://gist-it.appspot.com/github/mseln/yolo-octo-wallhack/blob/master/code-on-webpage/POST_parser.py"></script>

			<p.noindent>If you want any other value from a form, simply create a new variable.</p>

			<p>Example: <code>self.foo = get_float(request, 'id')</code></p>

			<div class=note>
				<p class=note-title>try: ... except: ... !?</p>
				<p>What does the try: ... except: ... statement above do? It's purpose is to test if something is possible to do, in this case convert a string to float. If it wouldn't be possible, an <a href="http://docs.python.org/2/tutorial/errors.html#exceptions">exception</a> would be thrown. If you don't handle the exception the program will crash, which is pretty bad.</p>

				<p>So how does it work? The program tries <code>(try:)</code> something, if it succeds, good! else handle the exception <code>(except:)</code> e.g. <code>print("Err: Conversion is not possible")</code></p>
			</div>

		</li>
		<li> 
			To prevent <a href="http://www.squarefree.com/securitytips/web-developers.html#CSRF">cross   site request forgery</a> (CSRF) Django requires you to take some measures that are described <a href="http://docs.djangoproject.com/en/dev/ref/contrib/csrf/">here</a>. Make sure that you follow these instructions.
		</li>
	</ol>
	<h5>User input</h5>
	<p>Since a user might click anywhere on the map, you have to implement an algorithm that finds the node in the map database closest to a given coordinate.  An initial approximation can be to find the node which has the closest distance to the selected coordinate. Luckily, you have already implemented function that computes the distance between two coordinates represented as a pair of latitude and longitude. A second approximation could be to find the <i>N</i> closest nodes and make a somewhat smart selection among these. A third approximation is to find the closest point on the edges between the nodes (and implicitly add a node there). This is very useful if there are long road segments and the selected location is right in the middle of that segment.</p>
	
	<p>As always, you should also create appropriate test cases.</p>

	<h5>Some more small extensions</h5>
	<ul>
		<li> 
			Extend the map application to display the start and destination with for example markers.
		</li>
		<li> 
			Extend the application to show the computed distance somewhere.
		</li>
	</ul>

	<h4>Find and display the shortest path</h4>
	Extend the map application to find and display the shortest <b>path</b> between two locations.

	<h5>Get the shortest path</h5> 
	Extract the shortest path from the output of your shortest path algorithm. Remember to extend the unit tests by adding new test cases.

	<h5>Visualize the shortest path</h5>
	Extend the application to display the computed shortest path on the map using, for example, the code developed as part of the previous milestones.

	Most applications that provide directions give the user some alternatives to choose from. Extend the map application to find alternative routes between two locations.
	<ol>
		<li> 
			The simplest approach is probably to extend the shortest path algorithm to compute the <i>X</i> shortest paths and display these. Does this provide good alternatives?
		</li>
		<li> 
			A more interesting approach could be to compute the <i>X</i> shortest paths and then find the <i>Y</i> paths among these that share the fewest number of nodes.
		</li>
		<li> 
			Can you find a better approach to compute alternative paths?
		</li>
	</ol>
		
	<h3><a id="extend">Extending Your Application Further</a></h3>
	After you have completed all these tasks, you have accomplished a lot. You have created and tested a graph data structure, populated it with data from the Open Street Map project, implemented and tested a shortest path algorithm, created a web application where a user can select multiple locations (and map these locations into nodes in the graph), displayed single and multiple paths in the web application, and more.

	What you have done so far provides you with both a set of components for more advanced map-based applications as well as an understanding of some of the basic issues involved in map-based applications. Now you will extend your application further or develop new applications starting from the code you already have. This is a very open ended project with many possibilities to create exciting map-based applications. Below are some example suggestions that you can chose from and extend as you like. You are also welcome to suggest your own improvements.

	<ul>
	<h3 class="projcount">Smaller improvements to the shortest path application:</h3>
	<ul>
		<li> 
			Add speed to the edges and let the user ask for the fastest way rather than the shortest. Can you provide better choices by minimizing the number of crossings that the user needs to pass?
		</li>
		<li> 
			Improve the efficiency of the application by for example adding a bounding box to the roads to filter out as many of them as possible before drawing them on the map.  If you do this, then it is a good idea to measure how long it takes to create the page so that you see that you are making progress.
		</li>
		<li> 
			Add a search box so that a user can enter an address which is looked up using the <a href="https://developers.google.com/maps/documentation/geocoding/">Google Geocoding API</a>.
		</li>
		<li> 
			Compare the shortest paths you find with the ones provided by the <a href="https://developers.google.com/maps/documentation/directions/">Google Directions API</a>.
		</li>
		<li> 
			Add support for buildings.  This would involve at least parsing the buildings from the OSM data, storing them in your application and displaying them on the map. You could also add further information so that when the mouse is hovering over a building you display some interesting piece of information about it.
		</li>
	</ul>

	<h3 class="projcount">Speed improvements to the shortest path application:</h3>
	<p>As stated in section 4.1. using a matrix is pretty unefficient for sparse graphs. You can do some improvements to speed up the algorithm.</p>
	<ol>
		<li>If you are not already using an adjacency list instead of matrix, then change it. An adjacency list is a list where each element is representing a node and all elements in the list are a list of all neighboors. The dictionary now becomes very handy since you can use the node id as key to a list conataining all neighboors to that node.</li>

			<table border=0 align="center">
				<tr>
					<td align="center">
							<img src="http://www.utm.edu/departments/math/graph/gifs/kbrgraph.gif" border=0>
					</td>
					<td align="center">
						<img src="http://upload.wikimedia.org/wikipedia/commons/5/5d/Konigsberg_bridges.png" border=0>
					</td>
				</tr>
				<tr>
					<td align="center">Just a simple graph.</td>
					<td align="center">The graph is acually representing<br>the seven bridges of <a href="http://en.wikipedia.org/wiki/Seven_Bridges_of_K%C3%B6nigsberg">Königsberg</a>.</td>
				</tr>
				<tr>
					<td align="center">
					<table border="1" >		
						<tr> <td> </td> <th>A</th>		<th>B</th> 		<th>C</th> 		<th>D</th> </tr>
						<tr> <th>A</th> <td>0</td>		<td>1</td> 		<td>1</td> 		<td>2</td> </tr>
						<tr> <th>B</th> <td>1</td>		<td>0</td> 		<td>inf</td> 	<td>3</td> </tr>
						<tr> <th>C</th> <td>1</td>		<td>inf</td> 	<td>0</td> 		<td>3</td> </tr>
						<tr> <th>D</th> <td>2</td>		<td>3</td> 		<td>3</td>		<td>0</td> </tr>
					</table>
					</td>
					<td align="center">
						<table border="1">
							<tr> <th>A</th> <td>(B, 1)</td>		<td>(C, 1)</td> 		<td>(D, 2)</td> 	 </tr>
							<tr> <th>B</th> <td>(A, 1)</td>		<td>(D, 3)</td> </tr>
							<tr> <th>C</th> <td>(A, 1)</td>		<td>(D, 3)</td> </tr>
							<tr> <th>D</th> <td>(A, 2)</td>		<td>(B, 3)</td> 		<td>(C, 3)</td> </tr>
						</table>
					</td>	
				</tr>
				<tr>
					<td align="center">Matrix representation of the graph</td>
					<td align="center">List representation of the graph</td>
				</tr>
			</table><br>

		The upper image to the left is showing a simple graph. The weight of the edges are the distance between the nodes, approximatly 1, 2 resp. 3 units. Actually the graph is an abstraction of the bridges in <a href="http://en.wikipedia.org/wiki/Seven_Bridges_of_K%C3%B6nigsberg">Königsberg</a> shown in the picture to the right. Below are two graphs. The one to the left is the matrix representation of the graph and the one to the left is the list representation, where every node has a list containing it's neighboors as a pair (neighboor, weight).</li>
		<br><br>
		<li>Implement dijkstra using a heap instead making lookup of min-element take constant "O(1)" instead of linear time "O(n)". Article about <a href="https://www.udacity.com/wiki/cs215/unit5solutions-1">dijkstra using a heap</a>.</li>
		<br>
		<li>Only consider nodes that contain a crossing. Since if there is a node with only one edge in to it and one from it you only have one path to choose i.e. consider that node in the calculation of the shortest path would be of no use.</li>
		
	</ol>

	<h3 class="projcount">All pairs shortest path</h3>
	<a href="http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm">Floyd-Warshall algorithm</a> is an algorithm to compute all shortest path between all pairs of nodes. The algorithm is really easy to implement. Read about it and answer these questions:
	<ol>
		<li>What is the time complexity?</li>
		<li>Estimate a maximum number of nodes the algorithm can handle in a reasonable amount of time</li>
	</ol><br>
	<ol> 
		<li> 
			Extend the map application to allow a user to select a set of coordinates.
		</li>
		<li> 
			Implement an all-pairs shortest path algorithm using the previously developed graph data structure including the API and the unit tests.
		</li>
		<li> 
			Extend the map application to display all the paths.
		</li>
	</ol>
	You can store the precalculated paths in a database, to make the application really fast. If you want to do that improvment, check out the extension project "Using a database".

	<h3 class="projcount">Using a database</h3> 
	Currently all the data is stored in memory and if you reload the page then all the data is loaded again. Extend the application to store all the data in a database instead. This makes the data persistent and potentially improves the efficiency of the application. This is also a good exercise since all modern web applications are database driven.  To get started we suggest that you read about <a href="http://www.djangobook.com/en/2.0/chapter05.html">Models</a> in the Django book. Try to move as much functionality into the database as possible, for example by replacing ClipNodes with a database query.

	Create an application which lets users record their current or planned future location. This can be used to see where your friends were last seen and potentially where to look for them.  Maybe you can connect the central schedule database to your application to show where you should be depending on what courses you take?

	Extend the application by collecting information from the user.  Initially it could be to only ask for the current position of the user.  Maybe you are even able to get that information from the GPS on the users device?

	If you have done the "all pairs shortest path" project you can use it to calculate the shortest path and store the precalculated paths in the data base.
	

	<h3 class="projcount">Build a beer pipeline!</h3>
	<p>You have been given the task of building a beer pipeline by connecting plastic tubes to provide all your friends with beer directly from HG. Since you are thirsty you want to minimize the total amount of plastic tubes that you have to connect before finishing the project. </p>

	<p>Extend the map application to allow a user to select a set of end points and then find the edges along which the pipeline should be built so that the total length of the pipeline is minimized and display the result on the map. You can make this problem easier or harder depending on how much freedom you consider to be allowed when constructing the pipeline. The simpler version is to only build the pipeline along existing roads. To make the problem harder, and the total length of the pipeline shorter, you can allow new nodes to be added. If you allow new nodes then you can start by ignoring buildings and then add these later. The more accurate you want the result, the more complicated it becomes.</p>

	<h3 class="projcount">Help a geocacher</h3>
	Your friend, an enthusiastic geocacher, has heard that you are building awesome map-based applications.  Since he is a bit lazy he has asked you to extend your application to allow him to select a set of geocaches and then automatically find the shortest route from his apartment visiting all the caches and then back to the apartment.
	</ul>
	<p>In any case you can either focus on developing the necessary algorithms, the web application or some combination of them. Remember to also implement the appropriate testing to increase the quality of your code and hopefully decrease the development time. If you decide to work more on the web application rather than the underlying algorithms you may use existing code libraries such as Google's APIs or graph libraries (for example <a href="http://networkx.lanl.gov">networkx</a>, <a href="http://igraph.sourceforge.net">igraph</a>).</p>
	</div>
</body>

</html> 
